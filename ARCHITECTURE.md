# ðŸ—ï¸ Supabase Integration Architecture

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (React + Vite)                      â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Public Routes  â”‚  â”‚ Protected Routes â”‚  â”‚  Role-Based Routesâ”‚  â”‚
â”‚  â”‚                 â”‚  â”‚                  â”‚  â”‚                   â”‚  â”‚
â”‚  â”‚  â€¢ Landing      â”‚  â”‚  â€¢ Onboarding    â”‚  â”‚  â€¢ Farmer Dash    â”‚  â”‚
â”‚  â”‚  â€¢ Login        â”‚  â”‚  â€¢ Profile Setup â”‚  â”‚  â€¢ Business Dash  â”‚  â”‚
â”‚  â”‚  â€¢ Role Select  â”‚  â”‚                  â”‚  â”‚  â€¢ Bank Dash      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                    â”‚                       â”‚             â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                â”‚                                     â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚           â”‚      AuthContext (useAuth hook)         â”‚                â”‚
â”‚           â”‚  â€¢ user, userProfile, loading           â”‚                â”‚
â”‚           â”‚  â€¢ signUp, signIn, signOut              â”‚                â”‚
â”‚           â”‚  â€¢ updateProfile, resetPassword         â”‚                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                             â”‚                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  Database Services   â”‚   â”‚   â”‚   Storage Service      â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                      â”‚   â”‚   â”‚                        â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ farmerService     â”‚   â”‚   â”‚  â€¢ encryptFile()       â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ businessService   â”‚   â”‚   â”‚  â€¢ decryptFile()       â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ bankService       â”‚   â”‚   â”‚  â€¢ uploadFile()        â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ dbUtils           â”‚   â”‚   â”‚  â€¢ downloadFile()      â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚             â”‚                â”‚              â”‚                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                â”‚                â”‚              â”‚                     â”‚
â”‚                â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                â”‚    â”‚   Supabase Client (supabase.js)  â”‚            â”‚
â”‚                â”‚    â”‚   â€¢ Authentication               â”‚            â”‚
â”‚                â”‚    â”‚   â€¢ Database (PostgreSQL)        â”‚            â”‚
â”‚                â”‚    â”‚   â€¢ Storage (S3-compatible)      â”‚            â”‚
â”‚                â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ HTTPS + RLS
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SUPABASE BACKEND                               â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Authentication                             â”‚ â”‚
â”‚  â”‚  â€¢ Email/Password Auth                                        â”‚ â”‚
â”‚  â”‚  â€¢ Session Management (JWT)                                   â”‚ â”‚
â”‚  â”‚  â€¢ Auto-refresh Tokens                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              PostgreSQL Database (with RLS)                   â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚  profiles    â”‚  â”‚  contracts  â”‚  â”‚ loan_applicationsâ”‚   â”‚ â”‚
â”‚  â”‚  â”‚              â”‚  â”‚             â”‚  â”‚                  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ id         â”‚  â”‚ â€¢ farmer_id â”‚  â”‚ â€¢ farmer_id      â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ role       â”‚  â”‚ â€¢ business  â”‚  â”‚ â€¢ contract_id    â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ full_name  â”‚  â”‚ â€¢ crop      â”‚  â”‚ â€¢ amount         â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ ...        â”‚  â”‚ â€¢ ...       â”‚  â”‚ â€¢ ...            â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚ â”‚
â”‚  â”‚  â”‚kyc_documents â”‚  â”‚file_metadataâ”‚                          â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  Row Level Security (RLS):                                   â”‚ â”‚
â”‚  â”‚  â€¢ Users can only access their own data                      â”‚ â”‚
â”‚  â”‚  â€¢ Role-based policies for cross-entity access               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  Storage (documents bucket)                   â”‚ â”‚
â”‚  â”‚                                                               â”‚ â”‚
â”‚  â”‚  users/                                                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ {user_id}/                                               â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ aadhaar/                                             â”‚ â”‚
â”‚  â”‚  â”‚   â”‚   â””â”€â”€ {file_id}.encrypted  â† AES-256 encrypted       â”‚ â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ pan/                                                 â”‚ â”‚
â”‚  â”‚  â”‚   â”‚   â””â”€â”€ {file_id}.encrypted                             â”‚ â”‚
â”‚  â”‚  â”‚   â””â”€â”€ bank_statements/                                     â”‚ â”‚
â”‚  â”‚  â”‚       â””â”€â”€ {file_id}.encrypted                             â”‚ â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Storage Policies:                                            â”‚ â”‚
â”‚  â”‚  â€¢ Users can only upload to their own folder                 â”‚ â”‚
â”‚  â”‚  â€¢ Users can only download their own files                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagrams

### 1. User Registration Flow

```
User                Frontend              AuthContext           Supabase
 â”‚                     â”‚                      â”‚                    â”‚
 â”‚  Fill signup form   â”‚                      â”‚                    â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚                    â”‚
 â”‚                     â”‚                      â”‚                    â”‚
 â”‚                     â”‚  signUp(email, pwd)  â”‚                    â”‚
 â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
 â”‚                     â”‚                      â”‚                    â”‚
 â”‚                     â”‚                      â”‚  auth.signUp()     â”‚
 â”‚                     â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                     â”‚                      â”‚                    â”‚
 â”‚                     â”‚                      â”‚  Create user       â”‚
 â”‚                     â”‚                      â”‚  Send verify email â”‚
 â”‚                     â”‚                      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                     â”‚                      â”‚                    â”‚
 â”‚                     â”‚  { user, session }   â”‚                    â”‚
 â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚
 â”‚                     â”‚                      â”‚                    â”‚
 â”‚  Navigate to        â”‚                      â”‚                    â”‚
 â”‚  onboarding        â”‚                      â”‚                    â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                    â”‚
 â”‚                     â”‚                      â”‚                    â”‚
```

### 2. Protected Route Access Flow

```
User              ProtectedRoute        AuthContext          Supabase
 â”‚                      â”‚                    â”‚                   â”‚
 â”‚  Navigate to         â”‚                    â”‚                   â”‚
 â”‚  /farmer/dashboard   â”‚                    â”‚                   â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                   â”‚
 â”‚                      â”‚                    â”‚                   â”‚
 â”‚                      â”‚  Check auth        â”‚                   â”‚
 â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
 â”‚                      â”‚                    â”‚                   â”‚
 â”‚                      â”‚  { loading: true } â”‚                   â”‚
 â”‚                      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
 â”‚                      â”‚                    â”‚                   â”‚
 â”‚  Show loading...     â”‚                    â”‚  getSession()     â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                      â”‚                    â”‚                   â”‚
 â”‚                      â”‚                    â”‚  { user, session }â”‚
 â”‚                      â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                      â”‚                    â”‚                   â”‚
 â”‚                      â”‚  Check role        â”‚                   â”‚
 â”‚                      â”‚  farmer === farmer?â”‚                   â”‚
 â”‚                      â”‚                    â”‚                   â”‚
 â”‚  Render dashboard    â”‚  âœ… Authorized     â”‚                   â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                   â”‚
 â”‚                      â”‚                    â”‚                   â”‚
```

### 3. Encrypted File Upload Flow

```
User            FileUpload     storageService    Encryption      Supabase
 â”‚                  â”‚               â”‚                â”‚               â”‚
 â”‚  Select file     â”‚               â”‚                â”‚               â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚                â”‚               â”‚
 â”‚                  â”‚               â”‚                â”‚               â”‚
 â”‚  Enter PIN/      â”‚               â”‚                â”‚               â”‚
 â”‚  password        â”‚               â”‚                â”‚               â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚                â”‚               â”‚
 â”‚                  â”‚               â”‚                â”‚               â”‚
 â”‚                  â”‚  uploadFile() â”‚                â”‚               â”‚
 â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚               â”‚
 â”‚                  â”‚               â”‚                â”‚               â”‚
 â”‚                  â”‚               â”‚  validateFile()â”‚               â”‚
 â”‚                  â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
 â”‚                  â”‚               â”‚                â”‚               â”‚
 â”‚                  â”‚               â”‚  encryptFile() â”‚               â”‚
 â”‚                  â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚               â”‚
 â”‚                  â”‚               â”‚                â”‚               â”‚
 â”‚                  â”‚               â”‚  AES-256-GCM   â”‚               â”‚
 â”‚                  â”‚               â”‚  encryption    â”‚               â”‚
 â”‚                  â”‚               â”‚                â”‚               â”‚
 â”‚                  â”‚               â”‚  { blob }      â”‚               â”‚
 â”‚                  â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
 â”‚                  â”‚               â”‚                â”‚               â”‚
 â”‚                  â”‚               â”‚  storage.upload()              â”‚
 â”‚                  â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                  â”‚               â”‚                                â”‚
 â”‚                  â”‚               â”‚  Store in bucket               â”‚
 â”‚                  â”‚               â”‚                                â”‚
 â”‚                  â”‚               â”‚  { path, id }                  â”‚
 â”‚                  â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                  â”‚               â”‚                                â”‚
 â”‚                  â”‚               â”‚  Insert metadata               â”‚
 â”‚                  â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚                  â”‚               â”‚                                â”‚
 â”‚                  â”‚  { fileId }   â”‚                                â”‚
 â”‚                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                â”‚
 â”‚                  â”‚               â”‚                                â”‚
 â”‚  Success!        â”‚               â”‚                                â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚                                â”‚
 â”‚                  â”‚               â”‚                                â”‚
```

### 4. Database Query with RLS

```
Frontend         Database Service     Supabase DB         RLS Policy
   â”‚                    â”‚                  â”‚                   â”‚
   â”‚  getFarmerLoans()  â”‚                  â”‚                   â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚                   â”‚
   â”‚                    â”‚                  â”‚                   â”‚
   â”‚                    â”‚  SELECT * FROM   â”‚                   â”‚
   â”‚                    â”‚  loan_apps       â”‚                   â”‚
   â”‚                    â”‚  WHERE farmer_id â”‚                   â”‚
   â”‚                    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
   â”‚                    â”‚                  â”‚                   â”‚
   â”‚                    â”‚                  â”‚  Check RLS        â”‚
   â”‚                    â”‚                  â”‚  Policy           â”‚
   â”‚                    â”‚                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                    â”‚                  â”‚                   â”‚
   â”‚                    â”‚                  â”‚  Verify:          â”‚
   â”‚                    â”‚                  â”‚  auth.uid() ==    â”‚
   â”‚                    â”‚                  â”‚  farmer_id        â”‚
   â”‚                    â”‚                  â”‚                   â”‚
   â”‚                    â”‚                  â”‚  âœ… Allowed       â”‚
   â”‚                    â”‚                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                    â”‚                  â”‚                   â”‚
   â”‚                    â”‚  { data: [...] } â”‚                   â”‚
   â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
   â”‚                    â”‚                  â”‚                   â”‚
   â”‚  { data, error }   â”‚                  â”‚                   â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚                   â”‚
   â”‚                    â”‚                  â”‚                   â”‚
```

---

## Component Interaction Map

```
App.jsx
  â”œâ”€â”€ AuthProvider (wraps entire app)
  â”‚   â””â”€â”€ Manages authentication state
  â”‚
  â”œâ”€â”€ LanguageProvider
  â”‚   â””â”€â”€ Manages language state
  â”‚
  â””â”€â”€ Router
      â”œâ”€â”€ PublicRoute
      â”‚   â”œâ”€â”€ LandingPage
      â”‚   â””â”€â”€ Login
      â”‚       â””â”€â”€ useAuth() â†’ signIn()
      â”‚
      â”œâ”€â”€ ProtectedRoute
      â”‚   â”œâ”€â”€ FarmerOnboarding
      â”‚   â”‚   â””â”€â”€ farmerService.createFarmerProfile()
      â”‚   â”œâ”€â”€ BusinessOnboarding
      â”‚   â”‚   â””â”€â”€ businessService.createBusinessProfile()
      â”‚   â””â”€â”€ BankOnboarding
      â”‚       â””â”€â”€ bankService.createBankProfile()
      â”‚
      â””â”€â”€ ProtectedRoute (with role check)
          â”œâ”€â”€ FarmerDashboard (role="farmer")
          â”‚   â”œâ”€â”€ farmerService.getFarmerContracts()
          â”‚   â””â”€â”€ farmerService.getFarmerLoans()
          â”‚
          â”œâ”€â”€ BusinessDashboard (role="business")
          â”‚   â”œâ”€â”€ businessService.getBusinessContracts()
          â”‚   â””â”€â”€ businessService.createContract()
          â”‚
          â””â”€â”€ BankDashboard (role="bank")
              â”œâ”€â”€ bankService.getLoanApplications()
              â””â”€â”€ bankService.updateLoanStatus()
```

---

## Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 1: Client-Side Encryption                            â”‚
â”‚  â€¢ Files encrypted before leaving browser                   â”‚
â”‚  â€¢ AES-256-GCM with user-controlled password                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 2: HTTPS Transport                                   â”‚
â”‚  â€¢ All data encrypted in transit                            â”‚
â”‚  â€¢ TLS 1.3 encryption                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 3: Supabase Authentication                           â”‚
â”‚  â€¢ JWT token verification                                   â”‚
â”‚  â€¢ Session management                                       â”‚
â”‚  â€¢ Role-based access control                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 4: Row Level Security (RLS)                          â”‚
â”‚  â€¢ Database-level access control                            â”‚
â”‚  â€¢ Automatic policy enforcement                             â”‚
â”‚  â€¢ User can only access own data                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 5: Storage at Rest                                   â”‚
â”‚  â€¢ Supabase encrypts all stored data                        â”‚
â”‚  â€¢ AES-256 encryption at rest                               â”‚
â”‚  â€¢ Separate encryption keys per customer                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## File Encryption Process

```
Original File (Aadhaar.pdf)
        â”‚
        â”‚ 1. Read as ArrayBuffer
        â–¼
   File Data (bytes)
        â”‚
        â”‚ 2. User enters password/PIN
        â–¼
   Derive Key (PBKDF2)
   â€¢ Salt (random 16 bytes)
   â€¢ 100,000 iterations
   â€¢ SHA-256 hash
        â”‚
        â–¼
   AES-256 Key
        â”‚
        â”‚ 3. Generate IV (random 12 bytes)
        â–¼
   Encrypt (AES-256-GCM)
        â”‚
        â–¼
   Encrypted Data
        â”‚
        â”‚ 4. Package with metadata
        â–¼
   {
     salt: [...],
     iv: [...],
     data: [...],
     fileName: "Aadhaar.pdf",
     fileType: "application/pdf"
   }
        â”‚
        â”‚ 5. Convert to Blob
        â–¼
   Upload to Supabase
        â”‚
        â–¼
   Stored as: users/{uid}/aadhaar/{id}.encrypted
```

---

## Database Relationships

```
auth.users (Supabase Auth)
    â”‚
    â”‚ id (UUID)
    â”‚
    â”œâ”€â”€> profiles
    â”‚      â€¢ id (FK to auth.users)
    â”‚      â€¢ role: farmer | business | bank
    â”‚      â€¢ full_name, email, phone
    â”‚      â€¢ role-specific fields
    â”‚
    â”œâ”€â”€> kyc_documents
    â”‚      â€¢ user_id (FK to profiles)
    â”‚      â€¢ document_type
    â”‚      â€¢ file_id (FK to file_metadata)
    â”‚      â€¢ verification_status
    â”‚
    â”œâ”€â”€> contracts
    â”‚      â€¢ farmer_id (FK to profiles)
    â”‚      â€¢ business_id (FK to profiles)
    â”‚      â€¢ crop_name, quantity, price
    â”‚      â€¢ status
    â”‚
    â”œâ”€â”€> loan_applications
    â”‚      â€¢ farmer_id (FK to profiles)
    â”‚      â€¢ contract_id (FK to contracts)
    â”‚      â€¢ loan_amount, tenure
    â”‚      â€¢ status
    â”‚
    â””â”€â”€> file_metadata
           â€¢ user_id (FK to profiles)
           â€¢ file_name, file_size
           â€¢ storage_path
           â€¢ encrypted: true/false
```

---

This architecture provides:
- âœ… **Scalability**: Supabase handles millions of requests
- âœ… **Security**: Multi-layer encryption and access control
- âœ… **Performance**: PostgreSQL with indexes and RLS
- âœ… **Maintainability**: Clean separation of concerns
- âœ… **Reliability**: Automatic backups and redundancy
